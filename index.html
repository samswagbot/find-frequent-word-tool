<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Newsela Project</title>
</head>
<body>
    <script>

        /*
What words or phrases appear more frequently in questions that students tend to do poorly on, and what appear more frequently in questions that students do well on?
We think this exercise should take about one hour. Please do not spend more than three hours working on it. Include a brief write-up of your solution and results in the body of your reply. You may respond to this email with questions.
 

It's acceptable to define "questions students did poorly/well on" as questions with percent correct values of less than 50% or greater than 50%, respectively. There may be other approaches or cutoff values that yield different results.

Consider how many appearances of a word there needs to be in order to say something about it. There may be words that should be excluded or sanitized.

        */

        // TODO
        // 4. show total score for scores above 50%
        // 5. general clean up, try and turn into a class 
        // 6. write up rely
        // 7. dependency
        // do you wanna get rid of actual quotes?
        // should I only grab questions?

        var xmlhttp = new XMLHttpRequest();

        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                const studentData = JSON.parse(xmlhttp.responseText);
                
                //students who scored less than 50% on tests
                const filteredPoorScores = [{
                    "text": "how are you doing?",
                    "percent_correct": 0.6551724137931034
                }, 
                {
                    "text": "Which of the following BEST describes why raising the minimum wage may harm small businesses?",
                    "percent_correct": 0.5932203389830508
                }, {
                    "text": "Read the sentences below: <blockquote>Women serve in the Army, Marines, Air Force and Navy. But many jobs have been off-limits to women.</blockquote> <blockquote>The Air Force said she had not really served in combat. They would not let her have a leadership role. </blockquote>Which of the following BEST explains the main idea of the section \"Ban Hurts Careers\"?",
	                "percent_correct": 0.3040473840078973
                }, {
	"text": "Which statement BEST describes Pope Benedict\u2019s position on modern issues?",
	"percent_correct": 0.44545454545454544
}, 

                ];
                // studentData.filter(scores => scores.percent_correct < .5);
                
                //santize words
                const sanitizedWords = [];
                for (var i = 0; i < filteredPoorScores.length; i++) {     
                    sanitizedWords[i] = filteredPoorScores[i].text
                    .toLowerCase()
                    .replace( /(<([^>]+)>)/ig, '') //removes blockquotes
                    .replace(/[\.,-?\/#!$%\^&\*;:{}=\-_`~()]/g,"")
                    .split(" ");   
                }
                console.log('santizedWords',sanitizedWords)
             
             
                var dictionary = {
                    phraseArr: [],
                    temp: [],
                    word: {},
                };
                
                var tempPhrase = [];
                var phraseCounter = 1;
                var  phraseWord, i, j;
                var k = 1;
                var sortedDictionary = [];
                var phrases;
                var mostFrequentWord, mostFrequentPhrase;

                for(i in sanitizedWords) {
                   const sentence = sanitizedWords[i]
                   for (j in sentence) {
                       console.log(word)
                        dictionary.word = sentence[j] 
                        dictionary[word] = dictionary[word] || 0; //count every word
                        dictionary[word]++;
                        //omits counting the first index
                        if(j !== word[0]){ 
                            dictionary.temp.push(word) //start phrase counting from first word
                            dictionary.phraseArr[dictionary.temp] = dictionary.temp[word] || 0;
                            dictionary.phraseArr[dictionary.temp]++;
                        }            
                   }
                    dictionary.phraseArr = [];
                    
                    for(k; k < sentence.length; k++) {
                        phraseCounter = k;
                        //counts phrases starting from index 1
                        for(phraseCounter; phraseCounter < sentence.length; phraseCounter++) {
                            phraseWord = sentence[phraseCounter]
                            tempPhrase.push(phraseWord)
                            //omits counting the first index
                            if(tempPhrase.length !== 1){ 
                                dictionary[tempPhrase] = dictionary[tempPhrase] || 0;
                                dictionary[tempPhrase]++ 
                            }
                        }
                        tempPhrase = [];
                    } 
                } 
                
                //sort words and phrases by occurence in an array
                for (phrases in dictionary) {
                    sortedDictionary.push([phrases, dictionary[phrases]]);
                }
               
               //compares elements in sortableWord arr, sorts them
                sortedDictionary.sort((a, b) => {
                    return b[1] - a[1];
                });
            
                 switch(sortedDictionary[0][0]){
                    case 'a':
                         sortedDictionary.shift();
                    case 'the':
                        sortedDictionary.shift();
                    case 'how': 
                        sortedDictionary.shift();
                    case 'of':  
                         sortedDictionary.shift();
                    case 'which':  
                         sortedDictionary.shift();            
                 }
                  console.log(sortedDictionary)
                var regex = new RegExp(/[,\-]/);
                
                var flattenedArr = sortedDictionary.flat()

                mostFrequentPhrase = flattenedArr.find((element) => {
                    return element[0].search(regex)
                })

                mostFrequentWord = flattenedArr.find((element) => {
                     if (element[0].indexOf(',')){
                         return element[0]
                    }
                })
                     
                console.log(`The most frequent word used is ${mostFrequentWord}`)
                console.log(`The most frequent phrase used is ${mostFrequentPhrase}`)
            }
        };

        xmlhttp.open("GET", "student-data.json", true);
        xmlhttp.send();
    </script>
</body>
</html>